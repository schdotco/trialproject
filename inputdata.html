<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Input Data Kesehatan</title>

<style>
:root{
  --primary:#3b5bdb;
  --bg:#f4f6f9;
  --card:#ffffff;
  --text:#212529;
  --muted:#6c757d;
}
*{box-sizing:border-box}
body{
  font-family: Arial, sans-serif;
  background: var(--bg);
  padding: 24px;
  color: var(--text);
}
.container{max-width:1100px;margin:auto}
.header{margin-bottom:24px}
.header h2{margin:0;font-size:24px}
.header p{margin:6px 0 0;color:var(--muted)}

.grid{
  display:grid;
  grid-template-columns: repeat(auto-fit,minmax(300px,1fr));
  gap:16px;
}

.card{
  background: var(--card);
  border-radius:12px;
  padding:16px;
  box-shadow:0 2px 8px rgba(0,0,0,.05);
}

.card h3{
  margin:0 0 12px;
  font-size:16px;
  border-left:4px solid var(--primary);
  padding-left:8px;
}

.row{
  display:grid;
  grid-template-columns: repeat(auto-fit,minmax(140px,1fr));
  gap:12px;
}

label{font-size:12px;color:var(--muted)}

input,select{
  width:100%;
  padding:10px;
  border-radius:8px;
  border:1px solid #dee2e6;
  font-size:14px;
}

input:focus,select:focus{
  outline:none;
  border-color:var(--primary);
}

.footer{
  margin-top:16px;
  display:flex;
  justify-content:flex-end;
}

.btn{
  padding:12px 24px;
  background:var(--primary);
  color:#fff;
  border:none;
  border-radius:10px;
  font-size:15px;
  cursor:pointer;
  box-shadow:0 4px 10px rgba(59,91,219,.3);
}

.btn.secondary{
  background:#495057;
  margin-right:10px;
}
.btn:hover{opacity:.95}
</style>
</head>

<body>
<div class="container">

<!-- HEADER -->
<div class="header">
  <h2>Input Data Agregat Puskesmas</h2>
  <p>Data wilayah per RW & laporan kesehatan bulanan</p>
</div>

<!-- ================= IDENTITAS LAPORAN KESEHATAN ================= -->
<div class="card">
  <h3>Identitas Laporan Kesehatan</h3>
  <div class="row">
    <div>
      <label>Bulan Laporan</label>
      <input type="month" id="bulanLapor">
    </div>
    <div>
      <label>RW</label>
      <select id="rwWilayah">
        <option value="">Pilih RW</option>
      </select>
    </div>
  </div>
</div>

<!-- ================= GRID DATA KESEHATAN ================= -->
<div class="grid">

  <!-- IBU HAMIL -->
  <div class="card">
    <h3>Ibu Hamil</h3>
    <div class="row">
      <div><label>Normal</label><input id="ihNormal" type="number"></div>
      <div><label>Risiko Tinggi</label><input id="ihRisti" type="number"></div>
      <div><label>KEK</label><input id="ihKek" type="number"></div>
    </div>
  </div>

  <!-- IBU NIFAS -->
  <div class="card">
    <h3>Ibu Nifas</h3>
    <div class="row">
      <div><label>Normal</label><input id="inNormal" type="number"></div>
      <div><label>Risiko Tinggi</label><input id="inRisti" type="number"></div>
    </div>
  </div>

  <!-- BAYI -->
  <div class="card">
    <h3>Bayi</h3>
    <div class="row">
      <div><label>Jumlah Bayi</label><input id="bayiTotal" type="number"></div>
    </div>
  </div>

  <!-- BALITA -->
  <div class="card">
    <h3>Balita</h3>
    <div class="row">
      <div><label>Normal</label><input id="bNormal" type="number"></div>
      <div><label>Stunting</label><input id="bStunting" type="number"></div>
      <div><label>Gizi Buruk</label><input id="bGizi" type="number"></div>
      <div><label>Penerima PMT</label><input id="bPMT" type="number"></div>
    </div>
  </div>

  <!-- TB -->
  <div class="card">
    <h3>TB</h3>
    <div class="row">
      <div><label>Dalam Pengobatan</label><input id="tbPengobatan" type="number"></div>
      <div><label>Selesai Pengobatan</label><input id="tbSelesai" type="number"></div>
    </div>
  </div>

  <!-- DIAGNOSA -->
  <div class="card">
    <h3>Diagnosa Penyakit</h3>
    <div class="row">
      <div><label>Hipertensi (HT)</label><input id="dgHT" type="number"></div>
      <div><label>Diabetes (DM)</label><input id="dgDM" type="number"></div>
      <div><label>ODGJ Berat</label><input id="dgODGJ" type="number"></div>
      <div><label>Kanker</label><input id="dgKanker" type="number"></div>
    </div>
  </div>

  <!-- PKPR -->
  <div class="card">
    <h3>PKPR (Usia 10â€“18 Tahun)</h3>
    <div class="row">
      <div><label>Total</label><input id="pkprTotal" type="number"></div>
      <div><label>Laki-laki</label><input id="pkprLaki" type="number"></div>
      <div><label>Perempuan</label><input id="pkprPerempuan" type="number"></div>
    </div>
  </div>

  <!-- DISABILITAS -->
  <div class="card">
    <h3>Disabilitas</h3>
    <div class="row">
      <div><label>Jumlah</label><input id="disabilitas" type="number"></div>
    </div>
  </div>

  <!-- LANSIA -->
  <div class="card">
    <h3>Lansia</h3>
    <div class="row">
      <div><label>Mandiri</label><input id="lMandiri" type="number"></div>
      <div><label>Kategori B Sedang</label><input id="lBSedang" type="number"></div>
      <div><label>Kategori B Ringan</label><input id="lBRingan" type="number"></div>
      <div><label>Kategori C</label><input id="lC" type="number"></div>
    </div>
  </div>

</div>

<div class="footer">
  <button id="btnSimpan" class="btn">
    ðŸ’¾ Simpan / Update Data Kesehatan
  </button>
</div>

</div>

<!-- ================= SCRIPT ================= -->
<script type="module">
import { db } from "./firebase.js";
import { doc, setDoc, serverTimestamp }
from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

/* ================= INIT ================= */
// isi RW 1â€“16
const rwWilayah=document.getElementById("rwWilayah");
for(let i=1;i<=16;i++){
  const o=document.createElement("option");
  o.value=`RW.${i}`;
  o.textContent=`RW ${i}`;
  rwWilayah.appendChild(o);
}

// default bulan
bulanLapor.value = new Date().toISOString().slice(0,7);

/* ================= SIMPAN DATA KESEHATAN ================= */
btnSimpan.onclick = async () => {
  if(!bulanLapor.value || !rwWilayah.value){
    alert("Bulan & RW wajib diisi");
    return;
  }

  const docId = `${bulanLapor.value}_${rwWilayah.value}`;

  await setDoc(
    doc(db,"kesehatan_agregat",docId),
    {
      /* IDENTITAS */
      bulanLapor: bulanLapor.value,
      rwWilayah: rwWilayah.value,

      /* IBU HAMIL */
      ihNormal: +ihNormal.value || 0,
      ihRisti: +ihRisti.value || 0,
      ihKEK: +ihKek.value || 0,

      /* IBU NIFAS */
      inNormal: +inNormal.value || 0,
      inRisti: +inRisti.value || 0,

      /* BAYI */
      bayiTotal: +bayiTotal.value || 0,

      /* BALITA */
      bNormal: +bNormal.value || 0,
      bStunting: +bStunting.value || 0,
      bGizi: +bGizi.value || 0,
      bPMT: +bPMT.value || 0,

      /* TB */
      tbPengobatan: +tbPengobatan.value || 0,
      tbSelesai: +tbSelesai.value || 0,

      /* DIAGNOSA */
      dgHT: +dgHT.value || 0,
      dgDM: +dgDM.value || 0,
      dgODGJ: +dgODGJ.value || 0,
      dgKanker: +dgKanker.value || 0,

      /* PKPR */
      pkprTotal: += x.pkprTotal.value || 0,
      t.pkprLaki       += x.pkprLaki || 0;
      t.pkprPerempuan += x.pkprPerempuan || 0;

      /* DISABILITAS */
      disabilitas: +disabilitas.value || 0,

      /* LANSIA */
      lMandiri: +lMandiri.value || 0,
      lBSedang: +lBSedang.value || 0,
      lBRingan: +lBRingan.value || 0,
      lC: +lC.value || 0,

      /* META */
      updatedAt: serverTimestamp()
    },
    { merge:true }
  );

  alert("âœ… Data kesehatan berhasil disimpan");
  location.reload(); // reset form
};
</script>

</body>
</html>
