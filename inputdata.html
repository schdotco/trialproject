<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Input Data Kesehatan</title>

  <style>
    body {
      font-family: Arial;
      background: #f4f6f9;
      padding: 20px;
    }
    h2 { margin-bottom: 10px; }
    h3 { margin-top: 20px; }

    .card {
      background: white;
      padding: 16px;
      border-radius: 10px;
      margin-bottom: 16px;
    }

    .row {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    input, select {
      padding: 8px;
      width: 100%;
      max-width: 220px;
    }

    .btn {
      padding: 10px 18px;
      background: #3b5bdb;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }

    .btn:hover {
      background: #364fc7;
    }
  </style>
</head>
<body>

<h2>Input Data Agregat Kesehatan</h2>

<!-- TANGGAL & RW -->
<div class="card">
  <h3>Identitas Laporan</h3>
  <div class="row">
    <input id="tanggal" type="date">
    <select id="rw">
      <option value="">Pilih RW</option>
      <option>RW.01</option>
      <option>RW.02</option>
      <option>RW.03</option>
      <option>RW.04</option>
      <option>RW.05</option>
      <option>RW.06</option>
      <option>RW.07</option>
      <option>RW.08</option>
      <option>RW.09</option>
      <option>RW.10</option>
      <option>RW.11</option>
      <option>RW.12</option>
      <option>RW.13</option>
      <option>RW.14</option>
      <option>RW.15</option>
      <option>RW.16</option>
    </select>
  </div>
</div>

<!-- IBU HAMIL -->
<div class="card">
  <h3>Ibu Hamil</h3>
  <div class="row">
    <input id="ihNormal" type="number" placeholder="Normal">
    <input id="ihRisti" type="number" placeholder="Risiko Tinggi">
  </div>
</div>

<!-- BALITA -->
<div class="card">
  <h3>Balita</h3>
  <div class="row">
    <input id="bNormal" type="number" placeholder="Normal">
    <input id="bStunting" type="number" placeholder="Stunting">
    <input id="bGizi" type="number" placeholder="Gizi Buruk">
  </div>
</div>

<!-- LAINNYA -->
<div class="card">
  <h3>Lainnya</h3>
  <div class="row">
    <input id="disabilitas" type="number" placeholder="Disabilitas">
    <input id="tbPengobatan" type="number" placeholder="TB Dalam Pengobatan">
    <input id="tbTotal" type="number" placeholder="Jumlah TB Terdeteksi">
  </div>
</div>

<!-- LANSIA -->
<div class="card">
  <h3>Lansia</h3>
  <div class="row">
    <input id="lMandiri" type="number" placeholder="Mandiri">
    <input id="lB" type="number" placeholder="Kategori B">
    <input id="lC" type="number" placeholder="Kategori C">
  </div>
</div>

<!-- SANITASI -->
<div class="card">
  <h3>Sanitasi</h3>
  <input id="odf" type="number" placeholder="ODF (0 / 1)">
</div>

<button id="btnSimpan" class="btn">Simpan Data</button>

<!-- SCRIPT -->
<script type="module">
  import { db } from "./firebase.js";
  import {
    collection,
    addDoc,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

  // default tanggal hari ini
  tanggal.valueAsDate = new Date();

  document.getElementById("btnSimpan").addEventListener("click", async () => {
    try {
      if (!rw.value) {
        alert("❌ RW harus dipilih");
        return;
      }

      const tgl = tanggal.value;          // YYYY-MM-DD
      const bulan = tgl.slice(0, 7);      // YYYY-MM

      await addDoc(collection(db, "kesehatan_agregat"), {
        tanggal: tgl,
        bulan: bulan,
        rw: rw.value,

        ibuHamilNormal: Number(ihNormal.value) || 0,
        ibuHamilRisti: Number(ihRisti.value) || 0,

        balitaNormal: Number(bNormal.value) || 0,
        balitaStunting: Number(bStunting.value) || 0,
        balitaGiziBuruk: Number(bGizi.value) || 0,

        disabilitas: Number(disabilitas.value) || 0,

        tbPengobatan: Number(tbPengobatan.value) || 0,
        tbTotal: Number(tbTotal.value) || 0,

        lansiaMandiri: Number(lMandiri.value) || 0,
        lansiaB: Number(lB.value) || 0,
        lansiaC: Number(lC.value) || 0,

        odf: Number(odf.value) || 0,

        createdAt: serverTimestamp()
      });

      alert("✅ Data berhasil disimpan");
      window.location.href = "dashboard.html";

    } catch (err) {
      console.error(err);
      alert("❌ Gagal menyimpan data");
    }
  });
</script>

</body>
</html>
