<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Input Data Kesehatan</title>
  <style>
    body { font-family: Arial; background:#f4f6f9; padding:20px; }
    .card { background:#fff; padding:16px; border-radius:10px; margin-bottom:16px; }
    .row { display:flex; gap:12px; flex-wrap:wrap; }
    input, select { padding:8px; max-width:220px; width:100%; }
    button { padding:10px 18px; background:#3b5bdb; color:#fff; border:none; border-radius:6px; }
  </style>
</head>
<body>

<h2>Input Data Agregat Kesehatan</h2>

<div class="card">
  <h3>Identitas Laporan</h3>
  <div class="row">
    <input type="month" id="bulanLapor">
    <select id="rw">
      <option value="">Pilih RW</option>
      ${Array.from({length:16},(_,i)=>`<option>RW.${String(i+1).padStart(2,'0')}</option>`).join("")}
    </select>
  </div>
</div>

<div class="card">
  <h3>Ibu Hamil</h3>
  <div class="row">
    <input id="ihNormal" type="number" placeholder="Normal">
    <input id="ihRisti" type="number" placeholder="Risiko Tinggi">
  </div>
</div>

<div class="card">
  <h3>Balita</h3>
  <div class="row">
    <input id="bNormal" type="number" placeholder="Normal">
    <input id="bStunting" type="number" placeholder="Stunting">
    <input id="bGizi" type="number" placeholder="Gizi Buruk">
  </div>
</div>

<div class="card">
  <h3>Lainnya</h3>
  <div class="row">
    <input id="disabilitas" type="number" placeholder="Disabilitas">
    <input id="tbPengobatan" type="number" placeholder="TB Dalam Pengobatan">
    <input id="tbTotal" type="number" placeholder="Jumlah TB">
  </div>
</div>

<div class="card">
  <h3>Lansia</h3>
  <div class="row">
    <input id="lMandiri" type="number" placeholder="Mandiri">
    <input id="lB" type="number" placeholder="Kategori B">
    <input id="lC" type="number" placeholder="Kategori C">
  </div>
</div>

<div class="card">
  <h3>Sanitasi</h3>
  <input id="odf" type="number" placeholder="ODF (0/1)">
</div>

<button id="btnSimpan">Simpan / Update Data</button>

<script type="module">
import { db } from "./firebase.js";
import { doc, setDoc, serverTimestamp }
from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

bulanLapor.value = new Date().toISOString().slice(0,7);

btnSimpan.onclick = async () => {
  if (!bulanLapor.value || !rw.value) {
    alert("Bulan & RW wajib diisi");
    return;
  }

  const docId = `${bulanLapor.value}_${rw.value}`;

  await setDoc(doc(db, "kesehatan_agregat", docId), {
    bulanLapor: bulanLapor.value,
    rw: rw.value,

    ibuHamilNormal: +ihNormal.value || 0,
    ibuHamilRisti: +ihRisti.value || 0,

    balitaNormal: +bNormal.value || 0,
    balitaStunting: +bStunting.value || 0,
    balitaGiziBuruk: +bGizi.value || 0,

    disabilitas: +disabilitas.value || 0,
    tbPengobatan: +tbPengobatan.value || 0,
    tbTotal: +tbTotal.value || 0,

    lansiaMandiri: +lMandiri.value || 0,
    lansiaB: +lB.value || 0,
    lansiaC: +lC.value || 0,

    odf: +odf.value || 0,
    updatedAt: serverTimestamp()
  });

  alert("Data berhasil diperbarui");
  location.href = "dashboard.html";
};
</script>

</body>
</html>
