<!DOCTYPE html>
<html>
<head>
  <title>Dashboard Data Kesehatan</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body { font-family: Arial; background: #f4f6f9; padding: 16px; }
    .row { display: flex; gap: 16px; margin-bottom: 16px; }
    .card {
      flex: 1;
      padding: 16px;
      border-radius: 10px;
      color: white;
    }
    .blue { background: #3b5bdb; }
    .purple { background: #7048e8; }
    .dark { background: #343a40; }
    .gray { background: #495057; }
    .white {
      background: white; color: black;
      padding: 16px; border-radius: 10px;
    }
  </style>
</head>
<body>

<h2>Dashboard Data Kesehatan</h2>

<!-- CARD ATAS -->
<div class="row">
  <div class="card blue">
    <h1 id="jmlIbuHamil">0</h1>
    Jumlah Ibu Hamil
  </div>
  <div class="card purple">
    <h1 id="jmlBalita">0</h1>
    Jumlah Balita
  </div>
  <div class="card dark">
    <h1 id="jmlTB">0</h1>
    TB Terdeteksi
  </div>
  <div class="card gray">
    <h1 id="odfVal">0</h1>
    ODF
  </div>
</div>

<!-- GRAFIK -->
<div class="row">
  <div class="white">
    <h3>Ibu Hamil</h3>
    <canvas id="chartIbu"></canvas>
  </div>
  <div class="white">
    <h3>Balita</h3>
    <canvas id="chartBalita"></canvas>
  </div>
</div>

<div class="row">
  <div class="white">
    <h3>Lansia</h3>
    <canvas id="chartLansia"></canvas>
  </div>
</div>

<script type="module">
import { db } from './js/firebase.js';
import { collection, query, orderBy, limit, getDocs }
from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

const q = query(
  collection(db, "kesehatan_agregat"),
  orderBy("createdAt", "desc"),
  limit(1)
);

const snap = await getDocs(q);
const d = snap.docs[0].data();

const ibuTotal = d.ibuHamilNormal + d.ibuHamilRisti;
const balitaTotal = d.balitaNormal + d.balitaStunting + d.balitaGiziBuruk;

jmlIbuHamil.innerText = ibuTotal;
jmlBalita.innerText = balitaTotal;
jmlTB.innerText = d.tbTotal;
odfVal.innerText = d.odf;

new Chart(chartIbu, {
  type: "pie",
  data: {
    labels: ["Normal", "Resiko Tinggi"],
    datasets: [{ data: [d.ibuHamilNormal, d.ibuHamilRisti] }]
  }
});

new Chart(chartBalita, {
  type: "pie",
  data: {
    labels: ["Normal", "Stunting", "Gizi Buruk"],
    datasets: [{ data: [d.balitaNormal, d.balitaStunting, d.balitaGiziBuruk] }]
  }
});

new Chart(chartLansia, {
  type: "bar",
  data: {
    labels: ["Mandiri", "Kategori B", "Kategori C"],
    datasets: [{ data: [d.lansiaMandiri, d.lansiaB, d.lansiaC] }]
  }
});
</script>

</body>
</html>
